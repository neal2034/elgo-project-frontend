stages:
  - clean
  - build
  - deploy


before_script:
  - BUILD_HOME="/mnt/build_home"
  - FRONTEND_SRC="$BUILD_HOME/elgo-frontend/$CI_COMMIT_REF_NAME"
  - APP_HOME="/mnt/websites/elgo/$CI_COMMIT_REF_NAME"
  - BUILD_COMMAND="build-web-$CI_COMMIT_REF_NAME";

clean:
  stage: clean
  only:
    - develop
    - master
  script:
    - echo "===========Clean=============="
    - rm -rf $FRONTEND_SRC
    - mkdir -p $FRONTEND_SRC


build:
  stage: build
  only:
    - develop
    - master
  script:
    - echo "===========Build==========="
    - git clone http://oauth2:2vEyDbk7vypebA1FByUZ@www.repo.elgo.cc/elgo/elgo-frontend.git -b $CI_COMMIT_REF_NAME $FRONTEND_SRC
    - cd $FRONTEND_SRC; cnpm i;  cnpm run $BUILD_COMMAND ;


deploy:
  stage: deploy
  only:
    - develop
    - master
  script:
    - echo "===========Deploy==========="
    - mkdir -p $APP_HOME
    - cp -rf $FRONTEND_SRC/dist/* $APP_HOME


